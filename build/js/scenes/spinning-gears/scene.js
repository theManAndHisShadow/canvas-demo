(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var i=function(){return e=function e(t){var r=t.title,i=t.ui,o=t.code;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.displayName="Scene",this.title=r,this.uiTree=i,this.ui=null,this.code=o,this.timestamp=null},(r=[{key:"execute",value:function(e){var t=e.root,r=this.code;t.children[0].textContent=this.title,r(t,this.ui.display,this.ui.states)}}])&&t(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}();function o(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(o=function(){return!!e})()}function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function h(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function d(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var f=function(){return d((function e(){c(this,e),this.events={}}),[{key:"addEventListener",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"dispatchEvent",value:function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))}}])}(),y=new WeakSet,v=function(e){function t(e){var r,i,l,h,s=e.id,d=void 0===s?null:s,u=e.renderer,f=e.cx,v=e.cy,b=e.r,g=e.angle,p=void 0===g?.001:g,m=e.direction,w=void 0===m?1:m,T=e.linkedTo,O=void 0===T?null:T,k=e.toothing,C=void 0===k?"external":k,S=e.numberOfTeeth,P=e.tootheHeight,H=e.role,E=void 0===H?"slave":H,j=e.fillColor,M=void 0===j?"rgba(255, 255, 255, 0.1)":j,R=e.alternativeFillColor,L=e.borderColor,W=void 0===L?"rgba(255, 255, 255, 1)":L,B=e.alternativeBorderColor,_=e.borderLineWidth,D=void 0===_?2:_,F=e.devMode,V=void 0!==F&&F;return c(this,t),R="string"==typeof R?R:x(C,E,.4),B="string"==typeof B?B:x(C,E,1),function(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}((i=this,l=n(l=t),r=function(e,t){if(t&&("object"==a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(i,o()?Reflect.construct(l,h||[],n(i).constructor):l.apply(i,h))),y),r.id=d,r.cx=f,r.cy=v,r.r=b,r.angle=p,r.direction=w,r.rotations=0,r.role=E,r.linkedTo="driver"==E?null:O,r.toothing=C,r.numberOfTeeth=S,r.tootheHeight=P,r.fillColor=M,r.alternativeFillColor=R,r.borderColor=W,r.alternativeBorderColor=B,r.borderLineWidth=D,r.renderer=u,r.devMode=V,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,e),d(t,[{key:"getRotationSpeed",value:function(e){var t=this;if(null===this.linkedTo)return 1;var r=e.find((function(e){return e.id===t.linkedTo}));return r.getRotationSpeed(e)*r.direction*(r.numberOfTeeth/this.numberOfTeeth*this.direction)}},{key:"rotate",value:function(e){this.angle+=e,Math.abs(this.angle)>=360&&(this.angle=this.angle%360,this.dispatchEvent("fullRotation"))}},{key:"render",value:function(){"external"==this.toothing?(h(y,this,b).call(this),h(y,this,p).call(this)):"internal"==this.toothing&&h(y,this,m).call(this)}}])}(f);function b(){var e=this.devMode?this.alternativeFillColor:this.fillColor,t=this.devMode?this.alternativeBorderColor:this.borderColor;if(drawCircle(this.renderer,{cx:this.cx,cy:this.cy,r:10,fillColor:"driver"==this.role?t:e,borderColor:t,borderThickness:this.borderLineWidth}),"driver"==this.role){var r=this.r/3,i={x:this.cx,y:this.cy-r-4},o=rotatePoint(this.cx,this.cy,i.x,i.y,this.angle);drawCircle(this.renderer,{cx:this.cx,cy:this.cy,r,fillColor:e,borderColor:t,borderThickness:this.borderLineWidth}),drawLine(this.renderer,{x1:this.cx,y1:this.cy,x2:o.x,y2:o.y,thickness:10,fillColor:t})}if(!0===this.devMode){var n={x:this.cx,y:this.cy-this.r+this.tootheHeight+5},l=rotatePoint(this.cx,this.cy,n.x,n.y,this.angle);drawLine(this.renderer,{x1:this.cx,y1:this.cy,x2:l.x,y2:l.y,thickness:3,color:"driver"==this.role?"red":"white"})}}function g(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.r-this.tootheHeight,r=[this.r,this.r,t,t],i=r.length,o=this.numberOfTeeth*i,n=0;n<o;n++){var l=2*Math.PI*n/o,h=r[n%i],a=this.cx+h*Math.cos(l),c=this.cy+h*Math.sin(l),s=rotatePoint(this.cx,this.cy,a,c,this.angle);0==n?this.renderer.moveTo(s.x,s.y):this.renderer.lineTo(s.x,s.y)}!0===e&&this.renderer.closePath()}function p(){var e=this.devMode?this.alternativeBorderColor:this.borderColor,t=this.devMode?this.alternativeFillColor:this.fillColor;this.renderer.beginPath(),h(y,this,g).call(this),this.renderer.fillStyle=t,this.renderer.strokeStyle=e,this.renderer.lineWidth=this.borderLineWidth,this.renderer.fill(),this.renderer.stroke(),this.renderer.closePath()}function m(){var e=this.devMode?this.alternativeBorderColor:this.borderColor,t=this.devMode?this.alternativeFillColor:this.fillColor;if(this.renderer.beginPath(),this.renderer.arc(this.cx,this.cy,this.r+8,0,2*Math.PI),h(y,this,g).call(this),this.renderer.closePath(),this.renderer.fillStyle=t,this.renderer.fill("evenodd"),this.renderer.lineWidth=this.borderLineWidth,this.renderer.strokeStyle=e,this.renderer.stroke(),this.devMode){var r={x:this.cx,y:this.cy+this.r},i=rotatePoint(this.cx,this.cy,r.x,r.y,this.angle);drawLine(this.renderer,{x1:this.cx,y1:this.cy,x2:i.x,y2:i.y,thickness:3,color:"white"})}}function x(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return"external"===e?"driver"===t?"rgba(255, 152, 0, ".concat(r,")"):"rgba(51, 127, 255, ".concat(r,")"):"rgba(158, 25, 45, ".concat(r,")")}var w=new i({title:"Spinning gears",ui:{description:{type:"display-infobox",label:"Description",text:"A visual demonstration of the «gear ratio» principle helps you see with your own eyes how gears with different numbers of teeth interact with each other."},dev:{type:"checkbox",label:"Show dev visual",state:!1},rotationSpeed:{type:"input",label:"Rotation speed",minValue:0,maxValue:100,defaultValue:5},selectedPreset:{type:"preset-dropdown-list",label:"Preset",selectedByDefault:0,options:[{name:"Big driver gear",allowedElements:["*"]},{name:"Small driver gear",allowedElements:["*"]},{name:"Chain of equal gears",allowedElements:["*"]},{name:"Chain 1:2:4",allowedElements:["*"]},{name:"Smooth increase",allowedElements:["*"]},{name:"Planetary gearbox",allowedElements:["*"]}]}},code:function(e,t,r){window.runningAnimations.clearQueue();var i=Date.now(),o=resetElement(e.querySelector("canvas"),"canvas-".concat(i));o.width=600,o.height=400;var n=o.getContext("2d"),l=200.5,h=[[{id:0,role:"driver",cx:361,cy:l,r:170,numberOfTeeth:30,tootheHeight:25},{id:1,linkedTo:0,cx:169,cy:174.5,r:40,numberOfTeeth:5,tootheHeight:18}],[{id:0,role:"driver",cx:169,cy:174.5,r:40,numberOfTeeth:5,tootheHeight:18},{id:1,linkedTo:0,cx:361,cy:l,r:170,numberOfTeeth:30,tootheHeight:25}],[{id:0,role:"driver",cx:484,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:1,linkedTo:0,angle:-35,cx:411,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:2,linkedTo:1,angle:-56,cx:338,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:3,linkedTo:2,angle:-90,cx:264,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:4,linkedTo:3,angle:-138,cx:191,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:5,linkedTo:4,angle:-173,cx:118,cy:l,r:40,numberOfTeeth:13,tootheHeight:10}],[{id:0,role:"driver",cx:531,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:1,linkedTo:0,angle:-16,cx:418,cy:l,r:80,numberOfTeeth:26,tootheHeight:14},{id:2,linkedTo:1,angle:-32,cx:189,cy:l,r:160,numberOfTeeth:52,tootheHeight:14}],[{id:0,role:"driver",cx:531,cy:l,r:40,numberOfTeeth:13,tootheHeight:10},{id:1,linkedTo:0,angle:13,cx:438,cy:l,r:60,numberOfTeeth:20,tootheHeight:12},{id:2,linkedTo:1,angle:7,cx:307,cy:l,r:80,numberOfTeeth:28,tootheHeight:12},{id:3,linkedTo:2,angle:7,cx:136,cy:l,r:100,numberOfTeeth:36,tootheHeight:12}],[{id:0,role:"driver",cx:301,cy:l,r:80,numberOfTeeth:28,tootheHeight:13},{id:1,linkedTo:0,cx:203,cy:273.5,r:50,numberOfTeeth:15,tootheHeight:14},{id:2,linkedTo:0,cx:400,cy:272.5,r:50,numberOfTeeth:15,tootheHeight:14},{id:3,linkedTo:0,cx:301,cy:78.5,r:50,numberOfTeeth:15,tootheHeight:14},{id:4,linkedTo:0,cx:301,cy:l,r:176,toothing:"internal",numberOfTeeth:55,tootheHeight:14}]],a=null;r.subscribe((function(e,i,o){"selectedPreset"==e&&(a=[],t.removeDynamicllyRendered(),h[i].forEach((function(e,o){var l=h[i].find((function(t){return t.id==e.linkedTo}));e.direction="driver"==e.role?1:-1*l.direction,e.renderer=n,e.devMode=r.getState("dev");var c=new v(e),s=translateIndexToLetter(o,!0),d="gear_".concat(s);if(h[i].find((function(e){return"internal"==e.toothing}))){var u="external"==c.toothing?"driver"==c.role?"sun":"planet":"ring";t.dynamicRender(d,{type:"display-item",label:"- ".concat(u," gear ").concat(s).concat(c.numberOfTeeth,"</span>")})}else t.dynamicRender(d,{type:"display-item",label:"- ".concat(c.role," gear ").concat(s).concat(c.numberOfTeeth,"</span>")});c.addEventListener("fullRotation",(function(){c.rotations+=1,t.updateValue(d,"".concat(c.rotations," revs."))})),a.push(c)}))),"dev"==e&&a.forEach((function(e){return e.devMode=i}))})),r.setState("selectedPreset",0),r.setState("dev",!1),window.runningAnimations.add((function(){n.clearRect(0,0,600,400),function(e,t){var r=t.canvasWidth,i=t.canvasHeight,o=!0===t.devMode?"#212125":"#5b55e1",n=25;drawRect(e,{x:0,y:0,width:r,height:i,fillColor:o}),drawGrid(e,{cellSize:25,lineThickness:.5,lineColor:"rgba(255, 255, 255, 0.01)"}),drawGrid(e,{cellSize:i/4,lineThickness:1,lineColor:"rgba(255, 255, 255, 0.04)"}),drawRect(e,{x:0,y:0,width:r,height:n,fillColor:o}),drawRect(e,{x:0,y:i-n+1,width:r,height:n,fillColor:o}),drawRect(e,{x:0,y:0,width:n,height:i,fillColor:o}),drawRect(e,{x:r-n+1,y:0,width:n,height:i,fillColor:o})}(n,{canvasWidth:600,canvasHeight:400,devMode:r.getState("dev")}),a.forEach((function(e,t){e.render();var i=r.getState("rotationSpeed")/10,o=e.getRotationSpeed(a);e.rotate(i*o)}))}))}});window.exportedObjects.push(w)})();